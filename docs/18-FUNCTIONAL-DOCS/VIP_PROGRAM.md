# VIP Program

## Overview

The VIP program rewards high-value customers with exclusive benefits. It supports automatic promotion based on spending thresholds, manual promotion by admins, configurable benefits, activity tracking, and performance analytics.

## Eligibility & Promotion

### Auto-Promotion

Customers are automatically evaluated for VIP status based on:
- **Lifetime spend** - Total amount spent across all orders
- **Order count** - Number of completed orders

The `vipService.checkVipEligibility(customerId)` function calculates these metrics and determines if a customer qualifies.

### Manual Promotion

Admins can manually promote any customer to VIP via:

`POST /api/vip/admin/promote/:customerId`

```json
{
  "notes": "Valued partner, manual upgrade"
}
```

The promotion records:
- Promotion source (`manual` or `auto`)
- Lifetime spend at time of promotion
- Order count at time of promotion
- Admin who performed the promotion
- Optional notes

## VIP Status

### Status Check

Authenticated customers can check their VIP status:

`GET /api/vip/status`

Returns:
- `isVip` - Boolean indicating active VIP membership
- `vipStatus` - Full status object with dates and tier info
- `benefits` - List of active benefits
- `eligibility` - Current metrics and progress toward VIP

### Status Values

| Status | Description |
|--------|-------------|
| `active` | Currently a VIP member |
| `expired` | VIP membership has lapsed |
| `revoked` | Manually removed by admin |

## Benefits

VIP members receive configurable benefits managed through the admin panel:

Typical benefits include:
- Free shipping on all orders
- Early access to new products
- Exclusive discounts
- Priority customer support
- Extended return window

Benefits are retrieved via `vipService.getVipBenefits(customerId)`.

## Activity Tracking

The system logs VIP-related activities:

`GET /api/vip/activity` (authenticated customer)

Activity types include:
- Promotion to VIP
- Benefit usage
- Status changes
- Milestone achievements

## Admin Management

### VIP Dashboard

The admin VIP management page provides:
- List of all VIP customers with status
- Promotion tools (manual and eligibility check)
- Activity history per customer
- Program analytics

### Eligibility Check

`GET /api/vip/admin/eligibility/:customerId`

Returns the customer's current metrics and whether they qualify for VIP:
- Lifetime spend amount
- Order count
- Whether thresholds are met
- Recommendation for promotion

### Analytics

`GET /api/vip/admin/analytics`

Returns program-wide metrics:

| Metric | Description |
|--------|-------------|
| `totalVips` | Total VIP customers |
| `activeVips` | Currently active VIPs |
| `vipRevenue` | Revenue generated by VIP customers |
| `vipRevenuePercent` | VIP revenue as percentage of total |
| `vipAov` | Average order value for VIP customers |
| `nonVipAov` | Average order value for non-VIP customers |
| `aovUplift` | Percentage increase in AOV for VIPs |
| `recentPromotions` | Recent VIP promotions with details |

These analytics are integrated into the Revenue Dashboard.

## Configuration

VIP program settings are managed through the admin settings:
- Spend threshold for auto-promotion
- Order count threshold for auto-promotion
- Active benefits list
- Program enable/disable toggle

## Related Files

- `server/src/routes/admin/vip.routes.ts` - VIP API routes
- `server/src/services/vip.service.ts` - VIP business logic
- `client/src/pages/admin-vip.tsx` - Admin VIP dashboard
- `client/src/pages/admin-revenue.tsx` - Revenue dashboard integration
